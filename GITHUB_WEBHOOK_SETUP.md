# üöÄ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—é —á–µ—Ä–µ–∑ GitHub Webhooks

## üìã –©–æ —Ü–µ –¥–∞—î?

–ü—Ä–∏ –∫–æ–∂–Ω–æ–º—É `git push` –≤ –≥—ñ–ª–∫—É `master` GitHub –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø–∏—Ç –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä, —è–∫–∏–π –≤–∏–∫–æ–Ω–∞—î:

```bash
cd /srv/helpDesk
git pull
pm2 restart all
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –∑–∞ 2-5 —Å–µ–∫—É–Ω–¥ –ø—ñ—Å–ª—è push! üéâ

---

## üîß –ö—Ä–æ–∫ 1: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ

### 1.1. –î–æ–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á –≤ `.env`

```bash
cd /srv/helpDesk/backend

# –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π —Å–µ–∫—Ä–µ—Ç
openssl rand -hex 32

# –î–æ–¥–∞–π—Ç–µ –≤ .env
nano .env
```

–î–æ–¥–∞–π—Ç–µ —Ä—è–¥–æ–∫:

```env
GITHUB_WEBHOOK_SECRET=–≤–∞—à_–∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π_—Å–µ–∫—Ä–µ—Ç_—Ç—É—Ç
```

### 1.2. –°—Ç–≤–æ—Ä—ñ—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è –ª–æ–≥—ñ–≤

```bash
mkdir -p /srv/helpDesk/backend/logs
touch /srv/helpDesk/backend/logs/deploy.log
```

### 1.3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –±–µ–∫–µ–Ω–¥

```bash
pm2 restart helpdesk-backend
pm2 logs helpdesk-backend --lines 30
```

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –Ω–µ–º–∞—î –ø–æ–º–∏–ª–æ–∫ —ñ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—É 5000.

---

## üåê –ö—Ä–æ–∫ 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è GitHub Webhook

### 2.1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ GitHub: https://github.com/Kultup/helpDesk
2. –ö–ª—ñ–∫–Ω—ñ—Ç—å **Settings** (‚öôÔ∏è)
3. –í –ª—ñ–≤–æ–º—É –º–µ–Ω—é –≤–∏–±–µ—Ä—ñ—Ç—å **Webhooks**
4. –ö–ª—ñ–∫–Ω—ñ—Ç—å **Add webhook**

### 2.2. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É

**Payload URL:**

```
https://helpdesk.krainamriy.fun/api/deploy/webhook
```

**Content type:**

```
application/json
```

**Secret:**

–í—Å—Ç–∞–≤—Ç–µ —Ç–æ–π —Å–∞–º–∏–π —Å–µ–∫—Ä–µ—Ç –∑ `.env` (GITHUB_WEBHOOK_SECRET)

**Which events would you like to trigger this webhook?**

- ‚úÖ –í–∏–±–µ—Ä—ñ—Ç—å **Just the push event**

**Active:**

- ‚úÖ –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ –≥–∞–ª–æ—á–∫–∞ —Å—Ç–æ—ó—Ç—å

### 2.3. –ó–±–µ—Ä–µ–∂—ñ—Ç—å

–ö–ª—ñ–∫–Ω—ñ—Ç—å **Add webhook**

---

## ‚úÖ –ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞

### 3.1. –¢–µ—Å—Ç–æ–≤–∏–π push

```bash
# –ó—Ä–æ–±—ñ—Ç—å –±—É–¥—å-—è–∫—É –Ω–µ–≤–µ–ª–∏–∫—É –∑–º—ñ–Ω—É
cd /path/to/local/helpDesk
echo "# Test webhook" >> README.md
git add .
git commit -m "Test webhook deployment"
git push
```

### 3.2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ GitHub

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å **Settings ‚Üí Webhooks**
2. –ö–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à webhook
3. –ü—Ä–æ–∫—Ä—É—Ç—ñ—Ç—å –¥–æ **Recent Deliveries**
4. –ú–∞—î –±—É—Ç–∏ –∑–µ–ª–µ–Ω–∞ –≥–∞–ª–æ—á–∫–∞ ‚úÖ —Ç–∞ –∫–æ–¥ **200**

### 3.3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä

```bash
# –î–∏–≤—ñ—Ç—å—Å—è –ª–æ–≥–∏ –¥–µ–ø–ª–æ—é
tail -f /srv/helpDesk/backend/logs/deploy.log

# –î–∏–≤—ñ—Ç—å—Å—è –ª–æ–≥–∏ PM2
pm2 logs helpdesk-backend --lines 50 | grep -i deploy
```

–ú–∞—î –±—É—Ç–∏:

```
üì• Webhook –æ—Ç—Ä–∏–º–∞–Ω–æ: Kultup/helpDesk ‚Üí refs/heads/master
üöÄ –ó–∞–ø—É—Å–∫–∞—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –¥–µ–ø–ª–æ–π...
‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø—ñ—à–Ω–∏–π!
```

---

## üîê –ë–µ–∑–ø–µ–∫–∞

### –í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏:

1. ‚úÖ **–°–µ–∫—Ä–µ—Ç –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π!** –ë–µ–∑ –Ω—å–æ–≥–æ –±—É–¥—å-—Ö—Ç–æ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –¥–µ–ø–ª–æ–π
2. ‚úÖ –°–µ–∫—Ä–µ—Ç –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ —Ç–∞ GitHub Webhook Settings
3. ‚úÖ –ù–Ü–ö–û–õ–ò –Ω–µ –∫–æ–º—ñ—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª –≤ Git!
4. ‚úÖ Webhook endpoint `/api/deploy/webhook` –ø—É–±–ª—ñ—á–Ω–∏–π, –∞–ª–µ –∑–∞—Ö–∏—â–µ–Ω–∏–π —Å–µ–∫—Ä–µ—Ç–æ–º

---

## üõ†Ô∏è –î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

### –†—É—á–Ω–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ API (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ–≤)

```bash
curl -X POST https://helpdesk.krainamriy.fun/api/deploy/manual \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

### –ü–µ—Ä–µ–≥–ª—è–¥ —Å—Ç–∞—Ç—É—Å—É –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –¥–µ–ø–ª–æ—é

```bash
curl https://helpdesk.krainamriy.fun/api/deploy/status \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

---

## üêõ Troubleshooting

### Webhook –Ω–µ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ GitHub:**

1. Settings ‚Üí Webhooks ‚Üí Recent Deliveries
2. –Ø–∫—â–æ –ø–æ–º–∏–ª–∫–∞ 500/401 - –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–µ–∫—Ä–µ—Ç
3. –Ø–∫—â–æ timeout - –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–Ω–∏–π

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä:**

```bash
# –ß–∏ –ø—Ä–∞—Ü—é—î –±–µ–∫–µ–Ω–¥?
pm2 list

# –ß–∏ —î –ø–æ–º–∏–ª–∫–∏?
pm2 logs helpdesk-backend --err --lines 50

# –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π URL?
curl -I https://helpdesk.krainamriy.fun/api/deploy/webhook
# –ú–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ 405 Method Not Allowed (–±–æ —Ü–µ POST endpoint)
```

### Git pull –Ω–µ –ø—Ä–∞—Ü—é—î

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞:**

```bash
# –ü—ñ–¥ —è–∫–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º PM2?
pm2 list

# –ß–∏ –º–æ–∂–µ —Ü–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–æ–±–∏—Ç–∏ git pull?
cd /srv/helpDesk
git pull
```

**–Ø–∫—â–æ –ø—Ä–æ–±–ª–µ–º–∞ –∑ SSH –∫–ª—é—á–∞–º–∏:**

```bash
# –î–ª—è HTTPS (–ø—Ä–æ—Å—Ç—ñ—à–µ):
git remote set-url origin https://github.com/Kultup/helpDesk.git

# –î–ª—è SSH:
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_rsa
```

### PM2 restart –Ω–µ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ PM2 –≤ PATH
which pm2

# –Ø–∫—â–æ –Ω—ñ - –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –ø–æ–≤–Ω–∏–π —à–ª—è—Ö
nano /srv/helpDesk/backend/controllers/deployController.js

# –ó–º—ñ–Ω—ñ—Ç—å:
exec('cd /srv/helpDesk && git pull && /usr/local/bin/pm2 restart all', ...)
```

---

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –î–∏–≤—ñ—Ç—å—Å—è –ª–æ–≥–∏ –¥–µ–ø–ª–æ—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

```bash
tail -f /srv/helpDesk/backend/logs/deploy.log
```

### –î–∏–≤—ñ—Ç—å—Å—è PM2 –ª–æ–≥–∏

```bash
pm2 logs helpdesk-backend --lines 100 | grep -E "(Webhook|Deploy|üì•|üöÄ|‚úÖ)"
```

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É `git push` –≤–∞—à –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ!

**Workflow:**

```
üìù –ü–∏—à–µ—Ç–µ –∫–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ
    ‚Üì
üíæ git add . && git commit -m "..." && git push
    ‚Üì
üåê GitHub –æ—Ç—Ä–∏–º—É—î push
    ‚Üì
üîî GitHub –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î webhook –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    ‚Üì
üöÄ –°–µ—Ä–≤–µ—Ä –≤–∏–∫–æ–Ω—É—î: git pull && pm2 restart all
    ‚Üì
‚úÖ –ö–æ–¥ –æ–Ω–æ–≤–ª–µ–Ω–æ –∑–∞ 2-5 —Å–µ–∫—É–Ω–¥!
```

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2026-02-05
