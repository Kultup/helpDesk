const logger = require('../utils/logger');

/**
 * –°–µ—Ä–≤—ñ—Å –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è AI —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è
 * –§–∞–∑–∞ 1: –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ñ –ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –µ–º–æ—Ü—ñ–π
 */
class AIEnhancedService {
  constructor() {
    // –ë–∞–∑–∞ —à–≤–∏–¥–∫–∏—Ö —Ä—ñ—à–µ–Ω—å –¥–ª—è —Ç–∏–ø–æ–≤–∏—Ö –ø—Ä–æ–±–ª–µ–º
    this.quickSolutions = {
      '–ø—Ä–∏–Ω—Ç–µ—Ä –Ω–µ –¥—Ä—É–∫—É—î': {
        keywords: ['–ø—Ä–∏–Ω—Ç–µ—Ä', '–Ω–µ –¥—Ä—É–∫—É—î', '–Ω–µ –ø–µ—á–∞—Ç–∞—î'],
        solution: `–°–ø—Ä–æ–±—É–π—Ç–µ —à–≤–∏–¥–∫–µ —Ä—ñ—à–µ–Ω–Ω—è:
1Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —î –ø–∞–ø—ñ—Ä —É –ª–æ—Ç–∫—É
2Ô∏è‚É£ **–Ø–∫—â–æ –ø—Ä–∏–Ω—Ç–µ—Ä –ø–æ –∫–∞–±–µ–ª—é** ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —à–Ω—É—Ä –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–æ –ü–ö
3Ô∏è‚É£ **–Ø–∫—â–æ –ø—Ä–∏–Ω—Ç–µ—Ä –ø–æ Wi‚ÄëFi** ‚Äî –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –Ω–æ—É—Ç–±—É–∫ —É —Ç—ñ–π —Å–∞–º—ñ–π –º–µ—Ä–µ–∂—ñ, —â–æ –π –ø—Ä–∏–Ω—Ç–µ—Ä (—Ç–æ–π —Å–∞–º–∏–π Wi‚ÄëFi)
4Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø—Ä–∏–Ω—Ç–µ—Ä (–≤–∏–º–∫–Ω—ñ—Ç—å –Ω–∞ 30 —Å–µ–∫)
5Ô∏è‚É£ –û—á–∏—Å—Ç—ñ—Ç—å —á–µ—Ä–≥—É –¥—Ä—É–∫—É –Ω–∞ –∫–æ–º–ø'—é—Ç–µ—Ä—ñ (–ü—É—Å–∫ ‚Üí –ü—Ä–∏—Å—Ç—Ä–æ—ó ‚Üí –ü—Ä–∏–Ω—Ç–µ—Ä–∏)

–Ø–∫—â–æ –Ω–µ –¥–æ–ø–æ–º–æ–∂–µ ‚Äî —Å—Ç–≤–æ—Ä—é —Ç—ñ–∫–µ—Ç, —ñ –∞–¥–º—ñ–Ω –ø—ñ–¥—ñ–π–¥–µ —à–≤–∏–¥—à–µ üòä`,
        category: 'Hardware',
        estimatedTime: '2-5 —Ö–≤–∏–ª–∏–Ω',
      },

      '–ø—Ä–∏–Ω—Ç–µ—Ä –∑–∞—Å—Ç—Ä—è–≥–∞—î –ø–∞–ø—ñ—Ä': {
        keywords: ['–ø–∞–ø—ñ—Ä –∑–∞—Å—Ç—Ä—è–≥–∞—î', '–∑–∞—Å—Ç—Ä—è–≥ –ø–∞–ø—ñ—Ä', 'paper jam'],
        solution: `–®–≤–∏–¥–∫–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –∑–∞—Å—Ç—Ä—è–≥–ª–æ–≥–æ –ø–∞–ø–µ—Ä—É:
1Ô∏è‚É£ –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤—Å—ñ –∫—Ä–∏—à–∫–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–∞
2Ô∏è‚É£ –û–±–µ—Ä–µ–∂–Ω–æ –≤–∏—Ç—è–≥–Ω—ñ—Ç—å –∑–∞—Å—Ç—Ä—è–≥–ª–∏–π –ø–∞–ø—ñ—Ä (—Ç—è–≥–Ω—ñ—Ç—å –∑–∞ –Ω–∞–ø—Ä—è–º–∫–æ–º —Ä—É—Ö—É)
3Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –Ω–µ–º–∞—î –∑–∞–ª–∏—à–∫—ñ–≤ –ø–∞–ø–µ—Ä—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ
4Ô∏è‚É£ –ó–∞–∫—Ä–∏–π—Ç–µ –∫—Ä–∏—à–∫–∏ —Ç–∞ —Å–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–¥—Ä—É–∫—É–≤–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É —Å—Ç–æ—Ä—ñ–Ω–∫—É

–Ø–∫—â–æ –ø–∞–ø—ñ—Ä –∑–∞—Å—Ç—Ä—è–≥–∞—î –ø–æ—Å—Ç—ñ–π–Ω–æ ‚Äî —Å—Ç–≤–æ—Ä—é —Ç—ñ–∫–µ—Ç –¥–ª—è –∞–¥–º—ñ–Ω–∞ üîß`,
        category: 'Hardware',
        estimatedTime: '3-5 —Ö–≤–∏–ª–∏–Ω',
      },

      '—ñ–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–µ –ø—Ä–∞—Ü—é—î': {
        keywords: ['—ñ–Ω—Ç–µ—Ä–Ω–µ—Ç', '–Ω–µ –ø—Ä–∞—Ü—é—î', '–Ω–µ–º–∞—î –∑–≤ º—è–∑–∫—É', 'wifi', 'wi-fi'],
        solution: `–°–ø—Ä–æ–±—É–π—Ç–µ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç:
1Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ä–æ—É—Ç–µ—Ä (–≤–∏–º–∫–Ω—ñ—Ç—å –Ω–∞ 30 —Å–µ–∫, —É–≤—ñ–º–∫–Ω—ñ—Ç—å)
2Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π –º–µ—Ä–µ–∂–µ–≤–∏–π –∫–∞–±–µ–ª—å
3Ô∏è‚É£ –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ —ñ–Ω—à–æ—ó Wi-Fi –º–µ—Ä–µ–∂—ñ
4Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∫–æ–º–ø'—é—Ç–µ—Ä

–Ø–∫—â–æ –Ω–µ –¥–æ–ø–æ–º–æ–∂–µ ‚Äî —Å—Ç–≤–æ—Ä—é —Ç—ñ–∫–µ—Ç –¥–ª—è –º–µ—Ä–µ–∂–µ–≤–æ–≥–æ –∞–¥–º—ñ–Ω–∞ üåê`,
        category: 'Network',
        estimatedTime: '5-10 —Ö–≤–∏–ª–∏–Ω',
      },

      '–∑–∞–±—É–≤ –ø–∞—Ä–æ–ª—å': {
        keywords: ['–∑–∞–±—É–≤ –ø–∞—Ä–æ–ª—å', '–Ω–µ –ø–∞–º º—è—Ç–∞—é –ø–∞—Ä–æ–ª—å', '—Å–∫–∏–Ω—É—Ç–∏ –ø–∞—Ä–æ–ª—å', 'reset password'],
        solution: `–°–ø—Ä–æ–±—É–π—Ç–µ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ —Å–∫–∏–Ω—É—Ç–∏ –ø–∞—Ä–æ–ª—å:
1Ô∏è‚É£ –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?" –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤—Ö–æ–¥—É
2Ô∏è‚É£ –í–≤–µ–¥—ñ—Ç—å –≤–∞—à—É email –∞–¥—Ä–µ—Å—É
3Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—à—Ç—É (—Ç–∞–∫–æ–∂ –ø–∞–ø–∫—É "–°–ø–∞–º")
4Ô∏è‚É£ –ü–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º —Ç–∞ —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –ø–∞—Ä–æ–ª—å

–Ø–∫—â–æ –ª–∏—Å—Ç –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å ‚Äî —Å—Ç–≤–æ—Ä—é —Ç—ñ–∫–µ—Ç –¥–ª—è –∞–¥–º—ñ–Ω–∞ üîê`,
        category: 'Access',
        estimatedTime: '2-3 —Ö–≤–∏–ª–∏–Ω–∏',
      },

      "–∫–æ–º–ø'—é—Ç–µ—Ä –ø–æ–≤—ñ–ª—å–Ω–æ –ø—Ä–∞—Ü—é—î": {
        keywords: ['–ø–æ–≤—ñ–ª—å–Ω–æ', '–≥–∞–ª—å–º—É—î', '–∑–∞–≤–∏—Å–∞—î', '—Ç–æ—Ä–º–æ–∑–∏—Ç—å'],
        solution: `–°–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏—Å–∫–æ—Ä–∏—Ç–∏ —Ä–æ–±–æ—Ç—É:
1Ô∏è‚É£ –ó–∞–∫—Ä–∏–π—Ç–µ –Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ (Ctrl+Shift+Esc ‚Üí –î–∏—Å–ø–µ—Ç—á–µ—Ä –∑–∞–≤–¥–∞–Ω—å)
2Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∫–æ–º–ø'—é—Ç–µ—Ä
3Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π –¥–∏—Å–∫ C: (–º–∞—î –±—É—Ç–∏ –º—ñ–Ω—ñ–º—É–º 10% –≤—ñ–ª—å–Ω–æ–≥–æ –º—ñ—Å—Ü—è)
4Ô∏è‚É£ –ó–∞–∫—Ä–∏–π—Ç–µ –∑–∞–π–≤—ñ –≤–∫–ª–∞–¥–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ

–Ø–∫—â–æ –Ω–µ –¥–æ–ø–æ–º–æ–∂–µ ‚Äî —Å—Ç–≤–æ—Ä—é —Ç—ñ–∫–µ—Ç, –∞–¥–º—ñ–Ω –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É üíª`,
        category: 'Hardware',
        estimatedTime: '5 —Ö–≤–∏–ª–∏–Ω',
      },

      '1—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è': {
        keywords: ['1—Å', '1c', '–Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è', '–Ω–µ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è'],
        solution: `–°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ 1–°:
1Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∫–æ–º–ø'—é—Ç–µ—Ä
2Ô∏è‚É£ –ó–∞–ø—É—Å—Ç—ñ—Ç—å 1–° –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
3Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç (1–° –ø–æ—Ç—Ä–µ–±—É—î –∑–≤ º—è–∑–æ–∫ –∑ —Å–µ—Ä–≤–µ—Ä–æ–º)

–Ø–∫—â–æ –Ω–µ –¥–æ–ø–æ–º–æ–∂–µ ‚Äî —Å—Ç–≤–æ—Ä—é —Ç—ñ–∫–µ—Ç, –∞–¥–º—ñ–Ω –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å –ª—ñ—Ü–µ–Ω–∑—ñ—é —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è üìä`,
        category: 'Software',
        estimatedTime: '3-5 —Ö–≤–∏–ª–∏–Ω',
      },

      '–Ω–µ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è —Ñ–∞–π–ª': {
        keywords: ['–Ω–µ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è —Ñ–∞–π–ª', '–Ω–µ –º–æ–∂—É –≤—ñ–¥–∫—Ä–∏—Ç–∏', '–ø–æ–º–∏–ª–∫–∞ —Ñ–∞–π–ª—É'],
        solution: `–°–ø—Ä–æ–±—É–π—Ç–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª:
1Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É (.docx, .xlsx, .pdf)
2Ô∏è‚É£ –°–ø—Ä–æ–±—É–π—Ç–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —ñ–Ω—à–æ—é –ø—Ä–æ–≥—Ä–∞–º–æ—é (–ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é ‚Üí –í—ñ–¥–∫—Ä–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é)
3Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø—Ä–æ–≥—Ä–∞–º—É
4Ô∏è‚É£ –°–ø—Ä–æ–±—É–π—Ç–µ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ñ–∞–π–ª –≤ —ñ–Ω—à—É –ø–∞–ø–∫—É

–Ø–∫—â–æ –Ω–µ –¥–æ–ø–æ–º–æ–∂–µ ‚Äî —Å—Ç–≤–æ—Ä—é —Ç—ñ–∫–µ—Ç, –º–æ–∂–ª–∏–≤–æ —Ñ–∞–π–ª –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π üìÑ`,
        category: 'Software',
        estimatedTime: '2-3 —Ö–≤–∏–ª–∏–Ω–∏',
      },

      '–ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞': {
        keywords: [
          '–ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞',
          '–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –ø—Ä–∞–≤–∞',
          'run as administrator',
          '–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞',
          '–Ω–µ –º–æ–∂—É –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏',
          '–¥–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ',
          'access denied',
          '–¥–æ–º–µ–Ω',
        ],
        solution: `‚ö†Ô∏è –ö–æ–º–ø'—é—Ç–µ—Ä–∏ –≤ –¥–æ–º–µ–Ω—ñ –º–∞—é—Ç—å –æ–±–º–µ–∂–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏.

–î–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏—Ö –∑–∞–¥–∞—á (–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º, –∑–º—ñ–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Å–∏—Å—Ç–µ–º–∏):
1Ô∏è‚É£ –ù–ï –Ω–∞–º–∞–≥–∞–π—Ç–µ—Å—å –æ–±—ñ–π—Ç–∏ –∑–∞—Ö–∏—Å—Ç —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ
2Ô∏è‚É£ –°—Ç–≤–æ—Ä—é —Ç—ñ–∫–µ—Ç –¥–ª—è –∞–¥–º—ñ–Ω–∞ - –≤—ñ–Ω –≤–∏–∫–æ–Ω–∞—î –∑–∞–¥–∞—á—É –≤—ñ–¥–¥–∞–ª–µ–Ω–æ
3Ô∏è‚É£ –ê–±–æ –∞–¥–º—ñ–Ω –Ω–∞–¥–∞—Å—Ç—å —Ç–∏–º—á–∞—Å–æ–≤—ñ –ø—Ä–∞–≤–∞, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ

–¶–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ —ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –±–µ–∑–ø–µ–∫–∏ –º–µ—Ä–µ–∂—ñ! üîí

–û–ø–∏—à—ñ—Ç—å —â–æ —Å–∞–º–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏, —ñ —è —Å—Ç–≤–æ—Ä—é —Ç—ñ–∫–µ—Ç`,
        category: 'Access',
        estimatedTime: '15-30 —Ö–≤–∏–ª–∏–Ω (–æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –∞–¥–º—ñ–Ω–∞)',
      },

      '–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º': {
        keywords: [
          '–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏',
          '–ø–æ—Å—Ç–∞–≤–∏—Ç–∏',
          '—ñ–Ω—Å—Ç–∞–ª—é–≤–∞—Ç–∏',
          'install',
          'setup',
          '—Å–∫–∞—á–∞—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º—É',
          '–ø–æ—Ç—Ä—ñ–±–µ–Ω –æ—Ñ—ñ—Å',
          '–ø–æ—Ç—Ä—ñ–±–µ–Ω word',
          '–ø–æ—Ç—Ä—ñ–±–µ–Ω excel',
          '–ø–æ—Ç—Ä—ñ–±–µ–Ω chrome',
        ],
        solution: `–ó—Ä–æ–∑—É–º—ñ–ª–æ, –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º—É. üñ•Ô∏è

1Ô∏è‚É£ –Ø —Å—Ç–≤–æ—Ä—é –∑–∞—è–≤–∫—É –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
2Ô∏è‚É£ –í—ñ–Ω –ø—ñ–¥–∫–ª—é—á–∏—Ç—å—Å—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ —ñ –≤—Å–µ –Ω–∞–ª–∞—à—Ç—É—î.
3Ô∏è‚É£ –í–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω—ñ—á–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ (—Ü–µ –±–µ–∑–ø–µ—á–Ω—ñ—à–µ!).

–ü—Ä–æ—Å—Ç–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞—è–≤–∫—É üëá`,
        category: 'Software',
        estimatedTime: '10-20 —Ö–≤–∏–ª–∏–Ω',
      },

      '–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º': {
        keywords: [
          '–æ–Ω–æ–≤–∏—Ç–∏',
          '–æ–Ω–æ–≤–ª–µ–Ω–Ω—è',
          'update',
          'upgrade',
          'patch',
          '–º–µ–¥–æ–∫',
          'medoc',
          '1—Å',
          '–±–∞—Å',
          'bas',
          'fredo',
        ],
        solution: `–ó—Ä–æ–∑—É–º—ñ–ª–æ, –ø–æ—Ç—Ä—ñ–±–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ü–ó. üîÑ

–¶–µ –∑–∞–¥–∞—á–∞ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—â–æ–± –≤—Å–µ –ø—Ä–æ–π—à–ª–æ –∫–æ—Ä–µ–∫—Ç–Ω–æ —ñ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–±–∏–ª–æ—Å—å).
–Ø –∑–∞—Ä–∞–∑ —Å—Ç–≤–æ—Ä—é –∑–∞—è–≤–∫—É, —ñ –∞–¥–º—ñ–Ω –ø—Ä–æ–≤–µ–¥–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —É –Ω–∞–π–±–ª–∏–∂—á–∏–π —á–∞—Å.

–¢–∏—Å–Ω—ñ—Ç—å "–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—ñ–∫–µ—Ç" üëá`,
        category: 'Software',
        estimatedTime: '15-30 —Ö–≤–∏–ª–∏–Ω',
      },

      '–∑–∞–º—ñ–Ω–∞ –∫–∞—Ä—Ç—Ä–∏–¥–∂–∞': {
        keywords: [
          '–∫–∞—Ä—Ç—Ä–∏–¥–∂',
          '—Ç–æ–Ω–µ—Ä',
          '–∑–∞–∫—ñ–Ω—á–∏–ª–∞—Å—å —Ñ–∞—Ä–±–∞',
          '–∑–∞–º—ñ–Ω–∏—Ç–∏ –∫–∞—Ä—Ç—Ä–∏–¥–∂',
          '–ø–æ–º—ñ–Ω—è—Ç–∏ –∫–∞—Ä—Ç—Ä–∏–¥–∂',
          '–Ω–µ–º–∞—î —Ñ–∞—Ä–±–∏',
          '—Å–≤—ñ—Ç–ª–∏–π –¥—Ä—É–∫',
        ],
        solution: `–ó–∞–∫—ñ–Ω—á–∏–≤—Å—è —Ç–æ–Ω–µ—Ä? –ó—Ä–æ–∑—É–º—ñ–≤. üñ®Ô∏è

–°—Ç–≤–æ—Ä—é—é –∑–∞—è–≤–∫—É –Ω–∞ –∑–∞–º—ñ–Ω—É –∫–∞—Ä—Ç—Ä–∏–¥–∂–∞.
–°–∏—Å—Ç–µ–º–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–∏–π–¥–µ —ñ –∑–∞–º—ñ–Ω–∏—Ç—å –π–æ–≥–æ.

*–ü—ñ–¥–∫–∞–∑–∫–∞:* –Ø–∫—â–æ –Ω–∞ –ø—Ä–∏–Ω—Ç–µ—Ä—ñ –ø–∏—à–µ "–ú–∞–ª–æ —Ç–æ–Ω–µ—Ä—É", –∞–ª–µ –≤—ñ–Ω —â–µ –¥—Ä—É–∫—É—î ‚Äî –º–æ–∂–Ω–∞ —Ç—Ä–æ—Ö–∏, –ø–æ—Ç—Ä—É—Å–∏—Ç–∏ –∫–∞—Ä—Ç—Ä–∏–¥–∂ (–±–µ—Ä–µ–∂–Ω–æ!), —Ü–µ –¥–∞—Å—Ç—å —â–µ 20-30 —Å—Ç–æ—Ä—ñ–Ω–æ–∫ üòâ`,
        category: 'Hardware',
        estimatedTime: '–ü—Ä–æ—Ç—è–≥–æ–º –¥–Ω—è',
      },

      '–¥–æ—Å—Ç—É–ø –¥–æ –ø–∞–ø–∫–∏': {
        keywords: [
          '–¥–æ—Å—Ç—É–ø –¥–æ –ø–∞–ø–∫–∏',
          '—Å–ø—ñ–ª—å–Ω–∞ –ø–∞–ø–∫–∞',
          '–º–µ—Ä–µ–∂–µ–≤–∞ –ø–∞–ø–∫–∞',
          '–Ω–µ –±–∞—á—É –ø–∞–ø–∫—É',
          '–ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –¥–∏—Å–∫',
          '–º–µ—Ä–µ–∂–µ–≤–∏–π –¥–∏—Å–∫',
        ],
        solution: `–ü–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ—Å—Ç—É–ø –¥–æ –º–µ—Ä–µ–∂–µ–≤–æ—ó –ø–∞–ø–∫–∏? üìÇ

–Ø —Å—Ç–≤–æ—Ä—é –∑–∞—è–≤–∫—É –¥–ª—è –∞–¥–º—ñ–Ω–∞. –ô–æ–º—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –∑–Ω–∞—Ç–∏:
1. –î–æ —è–∫–æ—ó —Å–∞–º–µ –ø–∞–ø–∫–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–æ—Å—Ç—É–ø
2. –î–ª—è –∫–æ–≥–æ (–≤–∞—Å —á–∏ –∫–æ–ª–µ–≥–∏)

–ê–ª–µ –∫—Ä–∞—â–µ –ø—Ä–æ—Å—Ç–æ —Å—Ç–≤–æ—Ä–∏–º–æ —Ç—ñ–∫–µ—Ç, —ñ –≤—ñ–Ω —Å–∞–º —É—Ç–æ—á–Ω–∏—Ç—å, —è–∫—â–æ —Ç—Ä–µ–±–∞.`,
        category: 'Access',
        estimatedTime: '10-15 —Ö–≤–∏–ª–∏–Ω',
      },

      new_accountant: {
        keywords: ['–Ω–æ–≤–∏–π –±—É—Ö–≥–∞–ª—Ç–µ—Ä', '–Ω–æ–≤–æ–≥–æ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞', '–æ—Ñ–æ—Ä–º–∏—Ç–∏ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞'],
        solution:
          '–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –π–æ–≥–æ –¥–∞–Ω—ñ. –ü—ñ–¥–∫–∞–∂—ñ—Ç—å, –±—É–¥—å –ª–∞—Å–∫–∞, —è–∫ –∑–≤–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞?',
        category: 'Access',
        needsMoreInfo: true, // Custom flag to trigger gathering_information
        missingInfo: ['–ü–Ü–ë –Ω–æ–≤–æ–≥–æ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞'],
        estimatedTime: '15-20 —Ö–≤–∏–ª–∏–Ω',
      },

      setup_accountant: {
        keywords: [
          '–Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –Ω–æ—É—Ç–±—É–∫ –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞',
          '–Ω–æ—É—Ç–±—É–∫ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—É',
          '–ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ –Ω–æ—É—Ç–±—É–∫ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—É',
        ],
        solution: `–ó—Ä–æ–∑—É–º—ñ–ª–æ. üíª
        
–°—Ç–≤–æ—Ä—é—é –∑–∞—è–≤–∫—É –Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–æ—É—Ç–±—É–∫–∞ –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –Ω–∞–±—ñ—Ä –ü–ó + M.E.Doc).
–°–∏—Å—Ç–µ–º–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ñ–∑—å–º–µ –≤ —Ä–æ–±–æ—Ç—É.`,
        category: 'Hardware',
        autoTicket: true,
        estimatedTime: '1-2 –≥–æ–¥–∏–Ω–∏',
      },

      // –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –±–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞—è–≤–∫–∏ (informationalOnly: true)
      '–≥—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏': {
        keywords: [
          '–≥—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏',
          '–∫–æ–ª–∏ –ø—Ä–∞—Ü—é—î —Ç–µ—Ö–ø—ñ–¥—Ç—Ä–∏–º–∫–∞',
          '–∫–æ–ª–∏ –ø—Ä–∞—Ü—é—î –ø—ñ–¥—Ç—Ä–∏–º–∫–∞',
          '—Ä–µ–∂–∏–º —Ä–æ–±–æ—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏',
          '–≥–æ–¥–∏–Ω–∏ —Ä–æ–±–æ—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏',
        ],
        solution:
          '–¢–µ—Ö–ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –ø—Ä–∞—Ü—é—î –≤ —Ä–æ–±–æ—á—ñ –≥–æ–¥–∏–Ω–∏ (–ø–Ω‚Äì–ø—Ç). –ó–∞—è–≤–∫–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –ø–æ —á–µ—Ä–∑—ñ. –Ø–∫—â–æ —î —Ç–µ—Ä–º—ñ–Ω–æ–≤–∞ –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –æ–ø–∏—à—ñ—Ç—å —ó—ó, —ñ —è —Å—Ç–≤–æ—Ä—é –∑–∞—è–≤–∫—É –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º.',
        category: 'Other',
        estimatedTime: null,
        informationalOnly: true,
      },
      '—Ö—Ç–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫—É': {
        keywords: [
          '—Ö—Ç–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫—É',
          '–¥–æ –∫–æ–≥–æ –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è',
          '–∫–æ–Ω—Ç–∞–∫—Ç –ø—ñ–¥—Ç—Ä–∏–º–∫–∏',
          '—Ö—Ç–æ –æ–±—Ä–æ–±–ª—è—î –∑–∞—è–≤–∫–∏',
        ],
        solution:
          '–ó–∞ —Ç–µ—Ö–Ω—ñ—á–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è —á–µ—Ä–µ–∑ —Ü–µ–π —á–∞—Ç ‚Äî —è –¥–æ–ø–æ–º–æ–∂—É –æ—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞—è–≤–∫—É –∞–±–æ –ø—ñ–¥–∫–∞–∂—É –∫—Ä–æ–∫–∏. –ê–¥–º—ñ–Ω –æ–±—Ä–æ–±–ª—è—î –∑–∞—è–≤–∫–∏ –ø–æ —á–µ—Ä–∑—ñ. –û–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É, —ñ —è —ó—ó –ø–µ—Ä–µ–¥–∞–º.',
        category: 'Other',
        estimatedTime: null,
        informationalOnly: true,
      },
    };

    // –ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –µ–º–æ—Ü—ñ–π–Ω–æ–≥–æ —Å—Ç–∞–Ω—É
    this.emotionKeywords = {
      urgent: {
        keywords: [
          '—Ç–µ—Ä–º—ñ–Ω–æ–≤–æ',
          '—à–≤–∏–¥–∫–æ',
          '–∑–∞—Ä–∞–∑',
          '–Ω–µ–≥–∞–π–Ω–æ',
          '–∫—Ä–∏—Ç–∏—á–Ω–æ',
          '–∞–≤–∞—Ä—ñ—è',
          '–Ω–µ –ø—Ä–∞—Ü—é—î –≤–∑–∞–≥–∞–ª—ñ',
          '–∫–ª—ñ—î–Ω—Ç–∏ —á–µ–∫–∞—é—Ç—å',
          '–∫–∞—Å–∞',
          '—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞',
        ],
        priority: 'urgent',
        tone: 'urgent',
      },
      frustrated: {
        keywords: [
          '–∑–Ω–æ–≤—É',
          '–≤–∂–µ',
          '–ø–æ—Å—Ç—ñ–π–Ω–æ',
          '–∑–∞–≤–∂–¥–∏',
          '–¥–æ—Å—Ç–∞–ª–æ',
          '—Ç—Ä–µ—Ç—ñ–π —Ä–∞–∑',
          '—â–æ–¥–Ω—è',
          '–∫–æ–∂–µ–Ω –¥–µ–Ω—å',
        ],
        priority: 'high',
        tone: 'frustrated',
      },
      calm: {
        keywords: ['–±—É–¥—å –ª–∞—Å–∫–∞', '–∫–æ–ª–∏ –∑–º–æ–∂–µ—Ç–µ', '–Ω–µ –ø–æ—Å–ø—ñ—à–∞–π—Ç–µ', '—è–∫—â–æ –º–æ–∂–Ω–∞'],
        priority: 'medium',
        tone: 'calm',
      },
    };
  }

  /**
   * –ü–æ—à—É–∫ —à–≤–∏–¥–∫–æ–≥–æ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –ø—Ä–æ–±–ª–µ–º–∏
   * @param {string} problemText - –¢–µ–∫—Å—Ç –ø—Ä–æ–±–ª–µ–º–∏
   * @returns {Object|null} –®–≤–∏–¥–∫–µ —Ä—ñ—à–µ–Ω–Ω—è –∞–±–æ null
   */
  findQuickSolution(problemText) {
    if (!problemText) {
      return null;
    }

    const text = problemText.toLowerCase();

    for (const [key, solution] of Object.entries(this.quickSolutions)) {
      // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ç–µ–∫—Å—Ç –º—ñ—Å—Ç–∏—Ç—å —Ö–æ—á–∞ –± –æ–¥–Ω–µ –∫–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ
      const hasKeyword = solution.keywords.some(keyword => text.includes(keyword.toLowerCase()));

      if (hasKeyword) {
        logger.info(`üí° –ó–Ω–∞–π–¥–µ–Ω–æ —à–≤–∏–¥–∫–µ —Ä—ñ—à–µ–Ω–Ω—è: ${key}`);
        const result = {
          problemType: key,
          solution: solution.solution,
          category: solution.category,
          estimatedTime: solution.estimatedTime,
          hasQuickFix: true,
          needsMoreInfo: solution.needsMoreInfo,
          missingInfo: solution.missingInfo || [],
          autoTicket: solution.autoTicket,
        };
        if (solution.informationalOnly) {
          result.informationalOnly = true;
        }
        return result;
      }
    }

    return null;
  }

  /**
   * –ê–Ω–∞–ª—ñ–∑ –µ–º–æ—Ü—ñ–π–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
   * @param {string} text - –¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
   * @returns {Object} –ï–º–æ—Ü—ñ–π–Ω–∏–π —Å—Ç–∞–Ω —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
   */
  analyzeEmotion(text) {
    if (!text) {
      return {
        emotion: 'calm',
        priority: 'medium',
        confidence: 0.5,
      };
    }

    const lowerText = text.toLowerCase();

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ caps lock (–∫—Ä–∏–∫)
    const capsRatio = (text.match(/[A-Z–ê-–Ø–Ü–á–Ñ“ê]/g) || []).length / text.length;
    const isShouting = capsRatio > 0.5 && text.length > 10;

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –±–∞–≥–∞—Ç–æ –∑–Ω–∞–∫—ñ–≤ –æ–∫–ª–∏–∫—É
    const exclamationCount = (text.match(/!/g) || []).length;
    const hasMultipleExclamation = exclamationCount >= 2;

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤
    for (const [emotion, data] of Object.entries(this.emotionKeywords)) {
      const matchCount = data.keywords.filter(keyword => lowerText.includes(keyword)).length;

      if (matchCount > 0 || (emotion === 'urgent' && (isShouting || hasMultipleExclamation))) {
        logger.info(
          `üéØ –í–∏–∑–Ω–∞—á–µ–Ω–æ –µ–º–æ—Ü—ñ—é: ${emotion} (matches: ${matchCount}, shouting: ${isShouting})`
        );

        return {
          emotion: emotion,
          priority: data.priority,
          tone: data.tone,
          confidence: Math.min(0.9, 0.6 + matchCount * 0.1),
          indicators: {
            keywordMatches: matchCount,
            isShouting,
            hasMultipleExclamation,
          },
        };
      }
    }

    // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º - —Å–ø–æ–∫—ñ–π–Ω–∏–π —Å—Ç–∞–Ω
    return {
      emotion: 'calm',
      priority: 'medium',
      tone: 'calm',
      confidence: 0.7,
      indicators: {
        keywordMatches: 0,
        isShouting: false,
        hasMultipleExclamation: false,
      },
    };
  }

  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –µ–º–æ—Ü—ñ–π
   * @param {Object} emotionData - –î–∞–Ω—ñ –ø—Ä–æ –µ–º–æ—Ü—ñ—ó
   * @param {string} baseResponse - –ë–∞–∑–æ–≤–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
   * @returns {string} –ê–¥–∞–ø—Ç–æ–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
   */
  adaptResponseToEmotion(emotionData, baseResponse) {
    const { emotion } = emotionData;

    const emotionalPrefixes = {
      urgent: ['–†–æ–∑—É–º—ñ—é —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å! üö®', '–¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ä–æ–∑—É–º—ñ—é! ‚ö°', '–ó–∞—Ä–∞–∑ —à–≤–∏–¥–∫–æ –¥–æ–ø–æ–º–æ–∂—É! üî•'],
      frustrated: [
        '–†–æ–∑—É–º—ñ—é, —â–æ —Ü–µ –¥—Ä–∞—Ç—É—î üòî',
        '–¢–∞–∫, —Ü–µ –Ω–µ–ø—Ä–∏—î–º–Ω–æ –∫–æ–ª–∏ –ø–æ—Å—Ç—ñ–π–Ω–æ üòû',
        '–†–æ–∑—É–º—ñ—é –≤–∞—à–µ —Ä–æ–∑—á–∞—Ä—É–≤–∞–Ω–Ω—è üíî',
      ],
      calm: ['', '–ó–≤—ñ—Å–Ω–æ –¥–æ–ø–æ–º–æ–∂—É üòä', '–ë–µ–∑ –ø—Ä–æ–±–ª–µ–º! üëç'],
    };

    const prefixes = emotionalPrefixes[emotion] || emotionalPrefixes.calm;
    const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];

    if (prefix) {
      return `${prefix}\n\n${baseResponse}`;
    }

    return baseResponse;
  }

  /**
   * –ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
   * @param {string} text - –¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
   * @returns {Object} –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª—ñ–∑—É
   */
  analyzeMessage(text) {
    const quickSolution = this.findQuickSolution(text);
    const emotion = this.analyzeEmotion(text);

    return {
      quickSolution,
      emotion,
      hasQuickFix: quickSolution !== null,
      suggestedPriority: emotion.priority,
      recommendedTone: emotion.tone,
    };
  }

  /**
   * –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ —à–≤–∏–¥–∫—ñ —Ä—ñ—à–µ–Ω–Ω—è
   * @returns {Array} –°–ø–∏—Å–æ–∫ —à–≤–∏–¥–∫–∏—Ö —Ä—ñ—à–µ–Ω—å
   */
  getAllQuickSolutions() {
    return Object.entries(this.quickSolutions).map(([key, solution]) => ({
      problemType: key,
      keywords: solution.keywords,
      category: solution.category,
      estimatedTime: solution.estimatedTime,
    }));
  }

  /**
   * –ü–æ—à—É–∫ —Ä—ñ—à–µ–Ω–Ω—è –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ —á–µ—Ä–µ–∑ Gemini –∑ Google Search
   * @param {string} problemText - –û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏
   * @returns {Object|null} –ó–Ω–∞–π–¥–µ–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è –∞–±–æ null
   */
  async searchInternetSolution(problemText) {
    try {
      const { GoogleGenerativeAI } = require('@google/generative-ai');
      const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

      // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –º–æ–¥–µ–ª—å –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é Google Search
      const model = genAI.getGenerativeModel({
        model: 'gemini-1.5-flash',
        tools: [
          {
            googleSearch: {},
          },
        ],
      });

      const prompt = `–¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç IT –ø—ñ–¥—Ç—Ä–∏–º–∫–∏. –ó–Ω–∞–π–¥–∏ –ê–ö–¢–£–ê–õ–¨–ù–ï —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è —Ü—ñ—î—ó –ø—Ä–æ–±–ª–µ–º–∏:

"${problemText}"

–Ü–ù–°–¢–†–£–ö–¶–Ü–á:
1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π Google Search –¥–ª—è –ø–æ—à—É–∫—É –∞–∫—Ç—É–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
2. –ó–Ω–∞–π–¥–∏ –æ—Ñ—ñ—Ü—ñ–π–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞ (Microsoft, –≤–∏—Ä–æ–±–Ω–∏–∫–∏ –ü–ó)
3. –°—Ç–≤–æ—Ä–∏ –°–¢–ò–°–õ–ï –ø–æ–∫—Ä–æ–∫–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è (–º–∞–∫—Å–∏–º—É–º 4-5 –∫—Ä–æ–∫—ñ–≤)
4. –í–∫–∞–∂–∏ –¥–∂–µ—Ä–µ–ª–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó

–§–û–†–ú–ê–¢ –í–Ü–î–ü–û–í–Ü–î–Ü (JSON):
{
  "hasSolution": true/false,
  "solution": "–ü–æ–∫—Ä–æ–∫–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è –∑ emoji",
  "source": "–ù–∞–∑–≤–∞ –¥–∂–µ—Ä–µ–ª–∞ (—Ä—ñ–∫)",
  "confidence": 0.0-1.0,
  "category": "Hardware/Software/Network/Access/Other"
}

–Ø–∫—â–æ –Ω–µ –∑–Ω–∞–π—à–æ–≤ —Ä—ñ—à–µ–Ω–Ω—è - hasSolution: false`;

      const result = await model.generateContent(prompt);
      const response = await result.response;
      let text = response.text();

      // –û—á–∏—â–∞—î–º–æ –≤—ñ–¥ markdown
      text = text
        .replace(/```json\n?/g, '')
        .replace(/```\n?/g, '')
        .trim();

      const parsed = JSON.parse(text);

      if (parsed.hasSolution && parsed.confidence >= 0.7) {
        logger.info(`üåê –ó–Ω–∞–π–¥–µ–Ω–æ —Ä—ñ—à–µ–Ω–Ω—è –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ: ${parsed.source}`);
        return {
          solution: parsed.solution,
          source: parsed.source,
          category: parsed.category,
          confidence: parsed.confidence,
          fromInternet: true,
        };
      }

      return null;
    } catch (error) {
      logger.error('–ü–æ–º–∏–ª–∫–∞ –ø–æ—à—É–∫—É –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ:', error);
      return null;
    }
  }

  /**
   * –†–æ–∑—à–∏—Ä–µ–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø–æ—à—É–∫–æ–º –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ
   * @param {string} text - –¢–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
   * @returns {Object} –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª—ñ–∑—É
   */
  async analyzeMessageWithInternet(text) {
    // –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞—Ç–∏—á–Ω—É –±–∞–∑—É
    const quickSolution = this.findQuickSolution(text);
    const emotion = this.analyzeEmotion(text);

    // –Ø–∫—â–æ —î —à–≤–∏–¥–∫–µ —Ä—ñ—à–µ–Ω–Ω—è - –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –π–æ–≥–æ
    if (quickSolution) {
      return {
        quickSolution,
        emotion,
        hasQuickFix: true,
        suggestedPriority: emotion.priority,
        recommendedTone: emotion.tone,
        source: 'static',
      };
    }

    // –Ø–∫—â–æ –Ω–µ–º–∞—î - —à—É–∫–∞—î–º–æ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ
    logger.info('üí° –°—Ç–∞—Ç–∏—á–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, —à—É–∫–∞—é –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ...');
    const internetSolution = await this.searchInternetSolution(text);

    if (internetSolution) {
      return {
        quickSolution: {
          problemType: 'internet_search',
          solution: `${internetSolution.solution}\n\nüìö –î–∂–µ—Ä–µ–ª–æ: ${internetSolution.source}`,
          category: internetSolution.category,
          hasQuickFix: true,
          fromInternet: true,
        },
        emotion,
        hasQuickFix: true,
        suggestedPriority: emotion.priority,
        recommendedTone: emotion.tone,
        source: 'internet',
      };
    }

    // –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
    return {
      quickSolution: null,
      emotion,
      hasQuickFix: false,
      suggestedPriority: emotion.priority,
      recommendedTone: emotion.tone,
      source: 'none',
    };
  }
}

module.exports = new AIEnhancedService();
