# Zabbix Alert Service - Stability Enhancements

## –û–≥–ª—è–¥

–°–µ—Ä–≤—ñ—Å Zabbix Alert Service –æ—Ç—Ä–∏–º–∞–≤ –∑–Ω–∞—á–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –Ω–∞–¥—ñ–π–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –≤ —É–º–æ–≤–∞—Ö –º–µ—Ä–µ–∂–µ–≤–∏—Ö –ø—Ä–æ–±–ª–µ–º, –≤–∏—Å–æ–∫–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –∑–±–æ—ó–≤ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤.

## –ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ

### 1. Retry –º–µ—Ö–∞–Ω—ñ–∑–º –∑ Exponential Backoff

**–ú–µ—Ç–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –Ω–µ–≤–¥–∞–ª–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –∑ —Ä–æ–∑—É–º–Ω–∏–º –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è–º.

**–§—É–Ω–∫—Ü—ñ—ó**:
- –ü–æ–≤—Ç–æ—Ä—é—î —Ç—ñ–ª—å–∫–∏ retryable –ø–æ–º–∏–ª–∫–∏ (–º–µ—Ä–µ–∂–µ–≤—ñ, —Ç–∞–π–º–∞—É—Ç–∏)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î exponential backoff –∑ jitter –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- –ù–∞–ª–∞—à—Ç–æ–≤—É–≤–∞–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏: –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä—ñ–≤, –∑–∞—Ç—Ä–∏–º–∫–∞, —Ç–∞–π–º–∞—É—Ç

**–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**:
```javascript
const result = await RetryUtils.withRetry(
  () => zabbixService.getProblems(severities, limit),
  {
    maxRetries: 3,
    baseDelay: 2000,
    timeout: 30000,
    retryCondition: RetryUtils.isRetryableError
  }
);
```

### 2. Circuit Breaker Pattern

**–ú–µ—Ç–∞**: –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∫–∞—Å–∫–∞–¥–Ω–∏—Ö –∑–±–æ—ó–≤ –ø—Ä–∏ –ø–æ—Å—Ç—ñ–π–Ω–∏—Ö –ø–æ–º–∏–ª–∫–∞—Ö.

**–°—Ç–∞–Ω–∏**:
- **CLOSED**: –ù–æ—Ä–º–∞–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞, –∑–∞–ø–∏—Ç–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å
- **OPEN**: –ó–∞–±–∞–≥–∞—Ç–æ –ø–æ–º–∏–ª–æ–∫, –∑–∞–ø–∏—Ç–∏ –±–ª–æ–∫—É—é—Ç—å—Å—è
- **HALF_OPEN**: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏**:
- `failureThreshold`: –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫ –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: 5)
- `recoveryTimeout`: –ß–∞—Å –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤ –º—Å (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: 60000)
- `monitoringPeriod`: –ü–µ—Ä—ñ–æ–¥ —Å–∫–∏–¥–∞–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: 300000)

### 3. Rate Limiting

**–ú–µ—Ç–∞**: –î–æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ª—ñ–º—ñ—Ç—ñ–≤ API Telegram –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –±–ª–æ–∫—É–≤–∞–Ω—å.

**–û–±–º–µ–∂–µ–Ω–Ω—è**:
- 30 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑–∞ —Ö–≤–∏–ª–∏–Ω—É
- 1000 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑–∞ –≥–æ–¥–∏–Ω—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—ñ –¥–æ –ª—ñ–º—ñ—Ç—ñ–≤

**–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**:
```javascript
const stats = service.getRateLimiterStats();
// –ü–æ–≤–µ—Ä—Ç–∞—î: totalRequests, lastMinute, lastHour, limitPerMinute, limitPerHour
```

### 4. Graceful Degradation

**–ú–µ—Ç–∞**: –ü—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ –∑ –æ–±–º–µ–∂–µ–Ω–∏–º —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª–æ–º –ø—Ä–∏ –∑–±–æ—ó –ø—ñ–¥—Å–∏—Å—Ç–µ–º.

**–ü–æ–≤–µ–¥—ñ–Ω–∫–∞**:
- –ü—Ä–∏ –∑–±–æ—ó Telegram: –ø—Ä–æ–¥–æ–≤–∂—É—î –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∞–ª–µ—Ä—Ç–∏, –ø—Ä–æ–ø—É—Å–∫–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
- –ü—Ä–∏ –∑–±–æ—ó Zabbix: –ø–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –ø–æ–º–∏–ª–∫—É
- –î–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω—É –ø—ñ–¥—Å–∏—Å—Ç–µ–º

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É**:
```javascript
const status = service.getSubsystemStatus();
// –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞–Ω –≤—Å—ñ—Ö –ø—ñ–¥—Å–∏—Å—Ç–µ–º —Ç–∞ –∑–∞–≥–∞–ª—å–Ω–µ –∑–¥–æ—Ä–æ–≤'—è
```

### 5. –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è

**–ú–µ—Ç–∞**: –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∑–±–æ—ó–≤ —á–µ—Ä–µ–∑ –Ω–µ–≤–∞–ª—ñ–¥–Ω—ñ –¥–∞–Ω—ñ.

**–í–∞–ª—ñ–¥–∞—Ü—ñ—è**:
- –ê–ª–µ—Ä—Ç—ñ–≤ –ø–µ—Ä–µ–¥ –æ–±—Ä–æ–±–∫–æ—é
- –ì—Ä—É–ø –∞–ª–µ—Ä—Ç—ñ–≤ –ø–µ—Ä–µ–¥ –≤—ñ–¥–ø—Ä–∞–≤–∫–æ—é —Å–ø–æ–≤—ñ—â–µ–Ω—å
- –î–µ—Ç–∞–ª—å–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

**–ü—Ä–∏–∫–ª–∞–¥**:
```javascript
const validation = service.validateAlert(alert);
if (!validation.isValid) {
  logger.error('Alert validation failed:', validation.errors);
  return { sent: 0, failed: 0, total: 0, errors: validation.errors };
}
```

### 6. Timeout –∑–∞—Ö–∏—Å—Ç

**–ú–µ—Ç–∞**: –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∑–∞–≤–∏—Å–∞–Ω–Ω—é –æ–ø–µ—Ä–∞—Ü—ñ–π.

**–§—É–Ω–∫—Ü—ñ—ó**:
- –¢–∞–π–º–∞—É—Ç –¥–ª—è –≤—Å—ñ—Ö –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –∑–∞–ø–∏—Ç—ñ–≤ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: 30 —Å–µ–∫—É–Ω–¥)
- –®–≤–∏–¥–∫–∏–π —Ñ–µ–π–ª –∑–∞–º—ñ—Å—Ç—å –¥–æ–≤–≥–æ–≥–æ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞–π–º–∞—É—Ç—ñ–≤ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É —Å–∏—Å—Ç–µ–º–∏

```javascript
// –ó–∞–≥–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –ø—ñ–¥—Å–∏—Å—Ç–µ–º
const status = service.getSubsystemStatus();
console.log('Overall health:', status.overallHealth);
console.log('Zabbix service:', status.zabbixService.initialized);
console.log('Telegram service:', status.telegramService.initialized);

// –°—Ç–∞–Ω circuit breaker
const circuitState = service.getCircuitBreakerStatus();
console.log('Circuit state:', circuitState.state);
console.log('Failure count:', circuitState.failureCount);

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ rate limiter
const rateStats = service.getRateLimiterStats();
console.log('Requests last minute:', rateStats.lastMinute);
console.log('Requests last hour:', rateStats.lastHour);
```

### –õ–æ–≥—É–≤–∞–Ω–Ω—è

–°–µ—Ä–≤—ñ—Å –∑–∞–±–µ–∑–ø–µ—á—É—î –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π:
- ‚úÖ –£—Å–ø—ñ—à–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- ‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º–∏
- ‚ùå –ü–æ–º–∏–ª–∫–∏ –∑ –¥–µ—Ç–∞–ª—è–º–∏ –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–æ–±–æ—Ç–∏ –ø—ñ–¥—Å–∏—Å—Ç–µ–º

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### Circuit Breaker
```javascript
const service = new ZabbixAlertService();
// –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ –∞–±–æ –∑–º—ñ–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ
```

### Rate Limiter
```javascript
// –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ ZabbixAlertService
this.telegramRateLimiter = new RateLimiter({
  requestsPerMinute: 30,
  requestsPerHour: 1000
});
```

### Retry –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
```javascript
// –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –≤ withRetry
await RetryUtils.withRetry(operation, {
  maxRetries: 3,
  baseDelay: 2000,
  timeout: 30000
});
```

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ:
```bash
npm test -- --testPathPattern=zabbixAlertServiceStability
```

–¢–µ—Å—Ç–∏ –ø–æ–∫—Ä–∏–≤–∞—é—Ç—å:
- Retry –º–µ—Ö–∞–Ω—ñ–∑–º –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Å—Ü–µ–Ω–∞—Ä—ñ—è–º–∏ –ø–æ–º–∏–ª–æ–∫
- Circuit breaker —Å—Ç–∞–Ω–∏ —Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏
- Rate limiting –ø–æ–≤–µ–¥—ñ–Ω–∫—É
- –í–∞–ª—ñ–¥–∞—Ü—ñ—é –¥–∞–Ω–∏—Ö
- Graceful degradation

## –ú—ñ–≥—Ä–∞—Ü—ñ—è

–ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ –ø—Ä–∞—Ü—é—é—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ –Ω–µ –≤–∏–º–∞–≥–∞—é—Ç—å –∑–º—ñ–Ω —É —ñ—Å–Ω—É—é—á–æ–º—É –∫–æ–¥—ñ. –°–µ—Ä–≤—ñ—Å –±—É–¥–µ –±—ñ–ª—å—à —Å—Ç—ñ–π–∫–∏–º –¥–æ –ø–æ–º–∏–ª–æ–∫ –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

1. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**: –†–µ–≥—É–ª—è—Ä–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ —Å—Ç–∞–Ω –ø—ñ–¥—Å–∏—Å—Ç–µ–º —á–µ—Ä–µ–∑ `getSubsystemStatus()`
2. **–õ–æ–≥—É–≤–∞–Ω–Ω—è**: –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∑–±—ñ—Ä –ª–æ–≥—ñ–≤ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –ø—Ä–æ–±–ª–µ–º
3. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è**: –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç–∏ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ –ø—ñ—Å–ª—è –∑–º—ñ–Ω
4. **–†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è**: –ó–∞–±–µ–∑–ø–µ—á—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ñ –∫–∞–Ω–∞–ª–∏ —Å–ø–æ–≤—ñ—â–µ–Ω—å –ø—Ä–∏ –∑–±–æ—ó Telegram

## –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å

–ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø–æ–≤–Ω—ñ—Å—Ç—é —Å—É–º—ñ—Å–Ω—ñ –∑ —ñ—Å–Ω—É—é—á–∏–º –∫–æ–¥–æ–º —Ç–∞ –Ω–µ –∑–º—ñ–Ω—é—é—Ç—å API —Å–µ—Ä–≤—ñ—Å—É. –í—Å—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—é—Ç—å –ø—Ä–æ–∑–æ—Ä–æ –¥–ª—è —Å–ø–æ–∂–∏–≤–∞—á—ñ–≤ —Å–µ—Ä–≤—ñ—Å—É.
