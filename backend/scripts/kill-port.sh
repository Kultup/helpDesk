#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤–±–∏–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—ñ–≤ –Ω–∞ –∑–∞–π–Ω—è—Ç–∏—Ö –ø–æ—Ä—Ç–∞—Ö
# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: ./kill-port.sh 5000

PORT=${1:-5000}

echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é –ø–æ—Ä—Ç $PORT..."

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –ø–æ—Ä—Ç –∑–∞–π–Ω—è—Ç–∏–π
if lsof -Pi :$PORT -sTCP:LISTEN -t >/dev/null 2>&1 ; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç $PORT –∑–∞–π–Ω—è—Ç–∏–π. –ó–∞–≤–µ—Ä—à—É—é –ø—Ä–æ—Ü–µ—Å–∏..."
    
    # –û—Ç—Ä–∏–º—É—î–º–æ PID –ø—Ä–æ—Ü–µ—Å—ñ–≤ –Ω–∞ –ø–æ—Ä—Ç—É
    PIDS=$(lsof -ti :$PORT)
    
    if [ -n "$PIDS" ]; then
        echo "üî™ –ó–Ω–∞–π–¥–µ–Ω–æ –ø—Ä–æ—Ü–µ—Å–∏: $PIDS"
        # –í–±–∏–≤–∞—î–º–æ –ø—Ä–æ—Ü–µ—Å–∏
        kill -9 $PIDS 2>/dev/null
        
        # –ß–µ–∫–∞—î–º–æ —Ç—Ä–æ—Ö–∏
        sleep 1
        
        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –ø–æ—Ä—Ç –∑–≤—ñ–ª—å–Ω–∏–≤—Å—è
        if lsof -Pi :$PORT -sTCP:LISTEN -t >/dev/null 2>&1 ; then
            echo "‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≤—ñ–ª—å–Ω–∏—Ç–∏ –ø–æ—Ä—Ç $PORT"
            exit 1
        else
            echo "‚úÖ –ü–æ—Ä—Ç $PORT –∑–≤—ñ–ª—å–Ω–µ–Ω–æ"
            exit 0
        fi
    fi
else
    echo "‚úÖ –ü–æ—Ä—Ç $PORT –≤—ñ–ª—å–Ω–∏–π"
    exit 0
fi
