#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –±–µ–∫–µ–Ω–¥–∞
# –û—á–∏—â—É—î –ø–æ—Ä—Ç–∏ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

echo "üöÄ Pre-start –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–ª—è helpdesk-backend..."

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ç–∞ –æ—á–∏—â—É—î–º–æ –ø–æ—Ä—Ç 5000
if command -v lsof &> /dev/null; then
    bash "$(dirname "$0")/kill-port.sh" 5000
else
    echo "‚ö†Ô∏è  lsof –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞—é –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø–æ—Ä—Ç—ñ–≤"
fi

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —ñ—Å–Ω—É—î .env
if [ ! -f "$(dirname "$0")/../.env" ]; then
    echo "‚ö†Ô∏è  –§–∞–π–ª .env –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"
fi

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MongoDB
echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é MongoDB..."
if command -v mongosh &> /dev/null; then
    mongosh --eval "db.adminCommand('ping')" --quiet > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        echo "‚úÖ MongoDB –¥–æ—Å—Ç—É–ø–Ω–∞"
    else
        echo "‚ö†Ô∏è  MongoDB –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
    fi
fi

echo "‚úÖ Pre-start –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
exit 0
